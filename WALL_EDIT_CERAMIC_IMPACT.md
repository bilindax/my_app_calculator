# ุชุฃุซูุฑ ุชุนุฏูู ุงูุฌุฏุฑุงู ุนูู ุญุณุงุจุงุช ุงูุณูุฑุงููู

## ๐ **ุงููุดููุฉ ุงูููุชุดูุฉ**

ุนูุฏ ุชุนุฏูู ุทูู ุฌุฏุงุฑ ุฃู ุฅุถุงูุฉ/ุญุฐู ุฌุฏุงุฑุ ูุงูุช ุญุณุงุจุงุช ุงูุณูุฑุงููู **ูุง ุชุชุญุฏุซ ุชููุงุฆูุงู**ุ ููุง ูุณุจุจ:
- โ ุงุฎุชูุงู ุจูู ุฃุฑูุงู ุงูุชุทุจูู ูุงูุฅูุณู
- โ ุณูุฑุงููู ุงูุฌุฏุฑุงู ูุธูุฑ ุจุฃุทูุงู ูุฏููุฉ ุญุชู ุจุนุฏ ุชุนุฏูู ุงูุฌุฏุฑุงู
- โ ุงููุณุชุฎุฏู ูุถุทุฑ ูุญุฐู ูุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุณูุฑุงููู ูุฏููุงู

---

## ๐งช **ุณููุงุฑูู ุงูุชูุถูุญ (Walkthrough)**

### **ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุบุฑูุฉ ูุทุจุฎ ูุน ุณูุฑุงููู**
```python
# ุบุฑูุฉ ูุทุจุฎ: ูุญูุท = 16.0ู
room = {
    'name': 'ูุทุจุฎ',
    'perim': 16.0,
    'area': 12.0,
    'wall_height': 3.0,
    'walls': [
        {'name': 'ุฌุฏุงุฑ ุดูุงู', 'length': 4.0, 'height': 3.0},
        {'name': 'ุฌุฏุงุฑ ุฌููุจ', 'length': 4.0, 'height': 3.0},
        {'name': 'ุฌุฏุงุฑ ุดุฑู', 'length': 4.0, 'height': 3.0},
        {'name': 'ุฌุฏุงุฑ ุบุฑุจ', 'length': 4.0, 'height': 3.0}
    ]
}

# ุณูุฑุงููู ุฌุฏุงุฑ: perimeter ร height
ceramic_zone = {
    'name': 'ุณูุฑุงููู ุฌุฏุงุฑ - ูุทุจุฎ',
    'room_name': 'ูุทุจุฎ',
    'surface_type': 'wall',
    'perimeter': 16.0,  # โ ุญูุธ ุงููุญูุท ุงูุญุงูู
    'height': 1.5,
    'effective_area': None  # ุณูุญุณุจ ุชููุงุฆูุงู
}

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
# ูุณุงุญุฉ ุงูุณูุฑุงููู = 16.0 ร 1.5 = 24.0 ูยฒ
```

### **ุงูุฎุทูุฉ 2: ุงููุณุชุฎุฏู ูุนุฏู ุทูู ุฌุฏุงุฑ**
```python
# ุชุนุฏูู ุฌุฏุงุฑ ุงูุดูุงู ูู 4.0 ุฅูู 5.0
room['walls'][0]['length'] = 5.0

# ุงููุญูุท ุงูุฌุฏูุฏ = 5.0 + 4.0 + 4.0 + 4.0 = 17.0ู
# ุงููุชููุน: ceramic_zone['perimeter'] โ 17.0
```

### **ุงููุดููุฉ ุงููุฏููุฉ โ:**
```python
# ุงูุณูุฑุงููู ูู ูุชุญุฏุซ!
ceramic_zone['perimeter'] = 16.0  # โ ูุง ูุฒุงู ุงููุฏูู!

# ุงููุชูุฌุฉ ูู Excel/ุงูุชุทุจูู:
# 16.0 ร 1.5 = 24.0 ูยฒ (ุฎุทุฃ! ูุฌุจ ุฃู ูููู 25.5)
```

### **ุงูุญู ุงูุฌุฏูุฏ โ:**
```python
# ุนูุฏ ุงุณุชุฏุนุงุก refresh_walls():
_update_ceramic_zones_after_wall_change()
    โ
# ูุนูุฏ ุญุณุงุจ perimeter ูู ุฌุฏุฑุงู ุงูุบุฑูุฉ:
ceramic_zone['perimeter'] = 17.0  # โ ุชุญุฏูุซ ุชููุงุฆู!

# ุงููุชูุฌุฉ ุงูุตุญูุญุฉ:
# 17.0 ร 1.5 = 25.5 ูยฒ โ
```

---

## ๐ง **ุงูุชุบููุฑุงุช ุงููุทุจูุฉ**

### **1. ูุธููุฉ `_update_ceramic_zones_after_wall_change()`**
ุชู ุฅุถุงูุฉ ุฏุงูุฉ ุฌุฏูุฏุฉ ูู `bilind_main.py`:
```python
def _update_ceramic_zones_after_wall_change(self):
    """ุชุญุฏูุซ ูุญูุท zones ุงูุณูุฑุงููู ุนูุฏ ุชุนุฏูู ุงูุฌุฏุฑุงู"""
    
    ููู ceramic_zone:
        ุฅุฐุง ูุงู ููุน ุงูุณุทุญ = 'wall':
            ุฅุฐุง ูู ููู ููุงู effective_area ูุญุฏุฏ ูุฏููุงู:
                ุงูุฑุฃ ุงูุบุฑูุฉ ุงููุฑุชุจุทุฉ
                ุงุญุณุจ ุงููุญูุท ูู ูุฌููุน ุฃุทูุงู ุงูุฌุฏุฑุงู
                ุญุฏูุซ zone.perimeter ุจุงููููุฉ ุงูุฌุฏูุฏุฉ
```

### **2. ุชุญุฏูุซ `refresh_walls()`**
```python
def refresh_walls(self):
    # ... refresh walls tab
    
    # ุฌุฏูุฏ: ุชุญุฏูุซ ุงูุณูุฑุงููู ุนูุฏ ุชุบููุฑ ุงูุฌุฏุฑุงู
    self._update_ceramic_zones_after_wall_change()
    if hasattr(self, 'ceramic_tab'):
        self.ceramic_tab.refresh_data()
    
    # ... refresh other tabs
```

---

## ๐ฏ **ูุชู ูุญุฏุซ ุงูุชุญุฏูุซ ุงูุชููุงุฆูุ**

### **ุงูุณููุงุฑูููุงุช ุงููุฏุนููุฉ:**
- โ ุชุนุฏูู ุทูู ุฌุฏุงุฑ (`edit_wall()`)
- โ ุชุนุฏูู ุงุฑุชูุงุน ุฌุฏุงุฑ
- โ ุญุฐู ุฌุฏุงุฑ (`delete_wall()`)
- โ ุฅุถุงูุฉ ุฌุฏุงุฑ ุฌุฏูุฏ ููุบุฑูุฉ
- โ ุงุฎุชูุงุฑ ุฌุฏุฑุงู ูู AutoCAD (Pick Walls)

### **ุงูุดุฑูุท:**
- ูุชู ุงูุชุญุฏูุซ ููุท ูู zones ูู ููุน `'wall'`
- ูุง ูุชู ุงูุชุญุฏูุซ ุฅุฐุง ูุงู `effective_area` ูุญุฏุฏ ูุฏููุงู (ูุญูุงูุฉ ุงูุชุฎุตูุต ุงููุฏูู)
- ูุชู ุงูุงุนุชูุงุฏ ุนูู `room.walls` ุฅู ูุฌุฏุชุ ูุฅูุง `room.perimeter`

---

## ๐ **ุงูุชุฏูู ุงููุงูู (Complete Flow)**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงููุณุชุฎุฏู ูุนุฏู ุฌุฏุงุฑ              โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ edit_wall() / add_wall() / etc.     โ
โ ุชุญุฏูุซ: project.walls[idx]          โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ refresh_walls()                     โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ _update_ceramic_zones_              โ
โ _after_wall_change()                โ
โ - ูุนูุฏ ุญุณุงุจ zone.perimeter         โ
โ - ูู ูุฌููุน room.walls lengths      โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ceramic_tab.refresh_data()          โ
โ - ูุนุฑุถ ุงูุฃุฑูุงู ุงูุฌุฏูุฏุฉ             โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Excel Export                        โ
โ - calculate_room_finish_metrics()   โ
โ - ูุณุชุฎุฏู zone.perimeter ุงููุญุฏูุซ    โ
โ - ุงููุชูุฌุฉ = perimeter ร height     โ
โ - ูุฎุตู ุงููุชุญุงุช                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ **ุงูุชุญูู**

### **ุงูุงุฎุชุจุงุฑุงุช (Tests):**
```bash
pytest tests/test_calculations.py -k ceramic
# โ 2 passed
```

### **ุงูุณููุงุฑูู ุงูุนููู:**
1. ุงูุชุญ ุงูุชุทุจูู
2. ุฃูุดุฆ ุบุฑูุฉ ูุทุจุฎ ุจูุญูุท 16ู
3. ุฃุถู ุณูุฑุงููู ุฌุฏุงุฑ ุจุงุฑุชูุงุน 1.5ู
4. ุชุญูู: ุงูุณูุฑุงููู = 24 ูยฒ
5. **ุนุฏูู ุฌุฏุงุฑ** ูุงุฌุนู ุทููู 5.0 ุจุฏูุงู ูู 4.0
6. **ุงููุชูุฌุฉ:** ุงูุณูุฑุงููู ูุชุญุฏุซ ุชููุงุฆูุงู ุฅูู 25.5 ูยฒ
7. ุตุฏูุฑ ุฅูู Excel โ ููุณ ุงูุฑูู! โ

---

## ๐ **ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก**

### **ุงูุญุงูุงุช ุงูุขููุฉ:**
- ุฅุฐุง ูุงู `zone.effective_area` ูุญุฏุฏ ูุฏููุงู โ **ูุง ูุชู ุงูุชุญุฏูุซ** (ุญูุธ ุงูุชุฎุตูุต)
- ุฅุฐุง ูุงู ุงูุณูุฑุงููู ูู ููุน `'floor'` ุฃู `'ceiling'` โ **ูุง ูุชุฃุซุฑ** ุจุชุนุฏูู ุงูุฌุฏุฑุงู
- ุฅุฐุง ูู ููู ููู zone ุงุณู ุบุฑูุฉ โ **ูุจูู ููุง ูู**

### **ุงูุชูุงูู:**
- ูุนูู ูุน zones ูู ููุน `dict` ู `CeramicZone` dataclass
- ูุฏุนู ุงูุบุฑู ูุน/ุจุฏูู `walls` (ูุณุชุฎุฏู `perimeter` ูู fallback)

---

## ๐ **ููุงุญุธุงุช ูููุณุชุฎุฏู**

### **ููุงุฐุง ูุฐุง ูููุ**
- ๐ฏ **ุฏูุฉ ุงูุญุณุงุจุงุช:** ุฃุฑูุงู ุงูุณูุฑุงููู ุชุชุทุงุจู ูุน ุงูุฌุฏุฑุงู ุงููุนููุฉ
- โก **ุชูููุฑ ุงูููุช:** ูุง ุญุงุฌุฉ ูุญุฐู ูุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุณูุฑุงููู ูุฏููุงู
- ๐ **ุงูุชุฒุงูู ุงูุชููุงุฆู:** ุงูุชุทุจูู ูุงูุฅูุณู ูุนุฑุถุงู ููุณ ุงูุฃุฑูุงู ุฏุงุฆูุงู

### **ูุชู ุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุณูุฑุงููู ูุฏููุงูุ**
- ุฅุฐุง ููุช ุจุชุฎุตูุต `effective_area` ูุฏููุงู ูุชุฑูุฏ ุงูุนูุฏุฉ ููุญุณุงุจ ุงูุชููุงุฆู:
  โ ุงุญุฐู ุงูู zone ูุฃุนุฏ ุฅูุดุงุฆู

### **ูุตูุญุฉ:**
ุจุนุฏ ุฃู ุชุนุฏููุงุช ุฌููุฑูุฉ ุนูู ุงูุฌุฏุฑุงู (ุฅุถุงูุฉ/ุญุฐู/ุชุนุฏูู):
- ุชุญูู ูู ุชุจููุจ ุงูุณูุฑุงููู
- ุงูุฃุฑูุงู ุณุชููู ูุญุฏูุซุฉ ุชููุงุฆูุงู โ
